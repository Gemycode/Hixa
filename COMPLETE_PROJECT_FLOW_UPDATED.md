# ุงูููู ุงููุงูู ุงููุญุฏุซ - Complete Updated Project Flow

## ๐ฏ ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ

### โ ุฅุถุงูุฉ Country & City

1. **Project Model** - ุชู ุฅุถุงูุฉ `country` ู `city` (required)
2. **User Model** - ุชู ุฅุถุงูุฉ `country` ู `city` (optional)
3. **ุฃููููุฉ ุงููููุน** - ุงููุดุงุฑูุน ุชุธูุฑ ูููููุฏุณูู ุญุณุจ ุงููููุน

---

## ๐ ุงูููู ุงููุงูู ุงููุญุฏุซ

### 1๏ธโฃ ุฅูุดุงุก ูุดุฑูุน (Client)

```
POST /api/projects
Headers: Authorization: Bearer {{clientToken}}
Body:
{
  "title": "ุจูุงุก ูููุง",
  "description": "...",
  "country": "ุงูุณุนูุฏูุฉ", โ Required (new)
  "city": "ุงูุฑูุงุถ", โ Required (new)
  "projectType": "Construction",
  "budget": { "amount": 100000, "currency": "SAR" }
}
```

**Response:**
```json
{
  "data": {
    "id": "...",
    "country": "ุงูุณุนูุฏูุฉ",
    "city": "ุงูุฑูุงุถ",
    "location": "ุงูุฑูุงุถ, ุงูุณุนูุฏูุฉ" // Auto-generated
  }
}
```

---

### 2๏ธโฃ ุชุญุฏูุซ ููู ุงููููุฏุณ (Engineer)

```
PUT /api/users/me
Headers: Authorization: Bearer {{engineerToken}}
Body:
{
  "country": "ุงูุณุนูุฏูุฉ", // Optional
  "city": "ุงูุฑูุงุถ" // Optional
}
```

**ูุชู ุชุญุฏูุซ:**
- โ `country` ู `city` ูู User Profile
- โ `location` ูุชู ุชูููุฏู ุชููุงุฆูุงู

---

### 3๏ธโฃ ุฌูุจ ุงููุดุงุฑูุน (Engineer)

```
GET /api/projects
Headers: Authorization: Bearer {{engineerToken}}
```

**ุงูุชุฑุชูุจ (ุฃููููุงุช):**

1. **ุฃููููุฉ ุนุงููุฉ**: ูุดุงุฑูุน ูู ููุณ ุงููุฏููุฉ
   - ุฅุฐุง `engineer.city = "ุงูุฑูุงุถ"`
   - ุงููุดุงุฑูุน ุจู `project.city = "ุงูุฑูุงุถ"` ุชุธูุฑ ุฃููุงู

2. **ุฃููููุฉ ูุชูุณุทุฉ**: ูุดุงุฑูุน ูู ููุณ ุงูุฏููุฉ (ูุฏู ูุฎุชููุฉ)
   - ุฅุฐุง `engineer.country = "ุงูุณุนูุฏูุฉ"`
   - ุงููุดุงุฑูุน ุจู `project.country = "ุงูุณุนูุฏูุฉ"` (ููู city ูุฎุชููุฉ) ุชุธูุฑ ุซุงููุงู

3. **ุฃููููุฉ ููุฎูุถุฉ**: ุจุงูู ุงููุดุงุฑูุน
   - ุงููุดุงุฑูุน ูู ุฏูู/ูุฏู ูุฎุชููุฉ ุชุธูุฑ ุฃุฎูุฑุงู

**ุฏุงุฎู ูู ูุฆุฉ**: ุงูุฃุญุฏุซ ุฃููุงู (ุญุณุจ `createdAt`)

---

### 4๏ธโฃ ุงูููุชุฑุฉ ุญุณุจ ุงููููุน

```
GET /api/projects?country=ุงูุณุนูุฏูุฉ
GET /api/projects?city=ุงูุฑูุงุถ
GET /api/projects?country=ุงูุณุนูุฏูุฉ&city=ุงูุฑูุงุถ
```

---

## ๐ ูุซุงู ุนูู ุงูุชุฑุชูุจ

### Engineer Profile:
```json
{
  "country": "ุงูุณุนูุฏูุฉ",
  "city": "ุงูุฑูุงุถ"
}
```

### Projects List (Engineer):
```
1. Project A - ุงูุฑูุงุถ, ุงูุณุนูุฏูุฉ โ (ููุณ ุงููุฏููุฉ - ุฃููููุฉ ุนุงููุฉ)
2. Project B - ุงูุฑูุงุถ, ุงูุณุนูุฏูุฉ โ (ููุณ ุงููุฏููุฉ - ุฃููููุฉ ุนุงููุฉ)
3. Project C - ุฌุฏุฉ, ุงูุณุนูุฏูุฉ โ (ููุณ ุงูุฏููุฉ - ุฃููููุฉ ูุชูุณุทุฉ)
4. Project D - ุงูุฏูุงู, ุงูุณุนูุฏูุฉ โ (ููุณ ุงูุฏููุฉ - ุฃููููุฉ ูุชูุณุทุฉ)
5. Project E - ุงููุงูุฑุฉ, ูุตุฑ โ (ุฏููุฉ ูุฎุชููุฉ - ุฃููููุฉ ููุฎูุถุฉ)
6. Project F - ุฏุจู, ุงูุฅูุงุฑุงุช โ (ุฏููุฉ ูุฎุชููุฉ - ุฃููููุฉ ููุฎูุถุฉ)
```

---

## ๐ Query Parameters

### Filtering:
- `?country=...` - ููุชุฑุฉ ุญุณุจ ุงูุฏููุฉ
- `?city=...` - ููุชุฑุฉ ุญุณุจ ุงููุฏููุฉ
- `?status=...` - ููุชุฑุฉ ุญุณุจ ุงูุญุงูุฉ
- `?projectType=...` - ููุชุฑุฉ ุญุณุจ ุงูููุน
- `?search=...` - ุงูุจุญุซ ูู ุงูุนููุงู ูุงููุตู

### Pagination:
- `?page=1` - ุฑูู ุงูุตูุญุฉ
- `?limit=10` - ุนุฏุฏ ุงููุชุงุฆุฌ

---

## ๐ ููุงุญุธุงุช

1. **Backward Compatibility:**
   - โ `location` field ูุง ูุฒุงู ููุฌูุฏ (optional)
   - โ ูุชู ุชูููุฏู ุชููุงุฆูุงู ูู `country` ู `city`

2. **Required Fields:**
   - โ `country` ู `city` required ูู ุฅูุดุงุก ุงููุดุฑูุน
   - โ `country` ู `city` optional ูู User Profile

3. **Location Priority:**
   - โ ุชุนูู ููุท ูููููุฏุณูู
   - โ ุชุญุชุงุฌ ุฃู ูููู ุงููููุฏุณ ูุฏูู `country` ุนูู ุงูุฃูู
   - โ `city` ุงุฎุชูุงุฑู (ุฅุฐุง ููุฌูุฏุ ุงูุฃููููุฉ ุฃุนูู)

---

## โ Checklist

- [x] Project Model ูุญุฏุซ
- [x] User Model ูุญุฏุซ
- [x] Validation schemas ูุญุฏุซุฉ
- [x] Project Controller ูุณุชุฎุฏู country ู city
- [x] ุฃููููุฉ ุงููููุน ุชุนูู ูููููุฏุณูู
- [x] Backward compatibility ูุญููุธุฉ

---

**๐ ุชู ุงูุชุญุฏูุซ**: ${new Date().toLocaleString('ar-SA')}
