# ูุฑุงุฌุนุฉ ุดุงููุฉ ููุธุงู ุงูุนุฑูุถ (Proposals System)

## โ ูุง ุชู ุฅุตูุงุญู ูุชุญุณููู:

### 1. ุชุญุณููุงุช ูู `createProposal`:
- โ ุฅุถุงูุฉ validation ููุชุฃูุฏ ูู ุฃู ุงููุดุฑูุน ูู ุญุงูุฉ `Waiting for Engineers`
- โ ุฅุถุงูุฉ validation ููุชุฃูุฏ ูู ููุงููุฉ ุงูุฃุฏูู ุนูู ุงููุดุฑูุน
- โ ููุน ุชูุฏูู ุนุฑูุถ ุนูู ูุดุงุฑูุน ุบูุฑ ููุงูู ุนูููุง

### 2. ุชุญุณููุงุช ูู `updateProposalStatus`:
- โ ุนูุฏ ูุจูู ุงูุนุฑุถ (`accepted`):
  - ุชุญุฏูุซ ุงููุดุฑูุน: ุชุนููู ุงููููุฏุณ (`assignedEngineer`)
  - ุชุบููุฑ ุญุงูุฉ ุงููุดุฑูุน ุฅูู `In Progress`
  - ุฑูุถ ุชููุงุฆู ูุฌููุน ุงูุนุฑูุถ ุงูุฃุฎุฑู ูููุดุฑูุน
  - ุฅูุดุงุก/ุชุญุฏูุซ ุบุฑูุฉ ุงูุฏุฑุฏุดุฉ ุงูุฌูุงุนูุฉ
  - ุฅุฑุณุงู ุฑุณุงูุฉ ูุธุงููุฉ ูู ุงูุฏุฑุฏุดุฉ

### 3. ุฅุถุงูุฉ `deleteProposal`:
- โ ุงููููุฏุณ ููููู ุญุฐู ุนุฑูุถู ุงูุฎุงุตุฉ (ุฅุฐุง ูุงูุช `pending`)
- โ ุงูุฃุฏูู ููููู ุญุฐู ุฃู ุนุฑุถ
- โ ุชุญุฏูุซ ุนุฏุฏ ุงูุนุฑูุถ ูู ุงููุดุฑูุน ุชููุงุฆูุงู

### 4. ุชุญุณููุงุช ูู Model:
- โ ุฅุถุงูุฉ ููุงุฑุณ ุฅุถุงููุฉ ููุฃุฏุงุก:
  - `{ engineer: 1, status: 1 }` - ููุจุญุซ ุนู ุนุฑูุถ ุงููููุฏุณ
  - `{ status: 1, createdAt: -1 }` - ููุจุญุซ ุญุณุจ ุงูุญุงูุฉ

### 5. ุชุญุณููุงุช ูู Populate:
- โ ุฅุถุงูุฉ `adminApproval` ูู populate ูููุดุฑูุน
- โ ุฅุถุงูุฉ `avatar` ูู populate ูููููุฏุณ

---

## ๐ ุงููุณุงุฑุงุช ุงููุชุงุญุฉ:

### ูููููุฏุณูู (Engineers):

#### 1. ุชูุฏูู ุนุฑุถ ุนูู ูุดุฑูุน
```
POST /api/proposals/project/:projectId
POST /api/proposals
```

**Headers:**
```
Authorization: Bearer ENGINEER_TOKEN
Content-Type: application/json
```

**Body:**
```json
{
  "projectId": "507f1f77bcf86cd799439011",
  "description": "ูุตู ุงูุนุฑุถ ูุงูููุชุฑุญ",
  "estimatedTimeline": "3 ุฃุดูุฑ",
  "relevantExperience": "ูุฏู ุฎุจุฑุฉ 5 ุณููุงุช ูู...",
  "proposedBudget": {
    "amount": 50000,
    "currency": "SAR"
  }
}
```

**ุดุฑูุท:**
- ุงููุดุฑูุน ูุฌุจ ุฃู ูููู ูู ุญุงูุฉ `Waiting for Engineers`
- ุงููุดุฑูุน ูุฌุจ ุฃู ูููู ููุงูู ุนููู ูู ุงูุฃุฏูู
- ุงููููุฏุณ ูู ููุฏู ุนุฑุถุงู ุนูู ูุฐุง ุงููุดุฑูุน ูู ูุจู

---

#### 2. ุฌูุจ ุนุฑูุถู
```
GET /api/proposals/my
```

**Response:**
```json
{
  "data": [
    {
      "id": "...",
      "project": {
        "_id": "...",
        "title": "ูุดุฑูุน ุจูุงุก",
        "status": "Waiting for Engineers",
        "assignedEngineer": null,
        "client": "...",
        "adminApproval": {
          "status": "approved"
        }
      },
      "engineer": "...",
      "description": "...",
      "estimatedTimeline": "...",
      "status": "pending",
      "createdAt": "..."
    }
  ]
}
```

---

#### 3. ุชุนุฏูู ุนุฑุถ (ุฎูุงู ุณุงุนุฉ ูู ุงูุฅูุดุงุก)
```
PUT /api/proposals/:id
```

**ููุงุญุธุฉ**: ุงููููุฏุณ ููููู ุงูุชุนุฏูู ููุท ุฎูุงู ุณุงุนุฉ ูู ููุช ุงูุฅูุดุงุก

---

#### 4. ุญุฐู ุนุฑุถ (ุฅุฐุง ูุงู pending)
```
DELETE /api/proposals/:id
```

---

### ููุนููุงุก (Clients):

#### 1. ุฌูุจ ุนุฑูุถ ูุดุฑูุนู
```
GET /api/proposals/project/:projectId
```

**ููุงุญุธุฉ**: ุงูุนููู ูุฑู ุฌููุน ุงูุนุฑูุถ ุนูู ูุดุงุฑูุนู

---

### ููุฃุฏูู (Admin):

#### 1. ุฌูุจ ุนุฑูุถ ูุดุฑูุน
```
GET /api/proposals/project/:projectId
```

---

#### 2. ูุจูู/ุฑูุถ/ุชุญุฏูุซ ุญุงูุฉ ุงูุนุฑุถ
```
PUT /api/proposals/:id/status
```

**Body:**
```json
{
  "status": "accepted" // ุฃู "rejected" ุฃู "reviewed"
}
```

**ุนูุฏ ูุจูู ุงูุนุฑุถ (`accepted`):**
- โ ูุชู ุชุนููู ุงููููุฏุณ ูููุดุฑูุน (`assignedEngineer`)
- โ ุญุงูุฉ ุงููุดุฑูุน ุชุชุบูุฑ ุฅูู `In Progress`
- โ ุฌููุน ุงูุนุฑูุถ ุงูุฃุฎุฑู ุชุชุญูู ุฅูู `rejected` ุชููุงุฆูุงู
- โ ูุชู ุฅูุดุงุก/ุชุญุฏูุซ ุบุฑูุฉ ุงูุฏุฑุฏุดุฉ ุงูุฌูุงุนูุฉ
- โ ูุชู ุฅุฑุณุงู ุฑุณุงูุฉ ูุธุงููุฉ

---

#### 3. ุชุนุฏูู ุฃู ุนุฑุถ
```
PUT /api/proposals/:id
```

---

#### 4. ุญุฐู ุฃู ุนุฑุถ
```
DELETE /api/proposals/:id
```

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู:

1. **ุงูุนููู ููุดุฆ ูุดุฑูุน** โ `Pending Review`
2. **ุงูุฃุฏูู ููุงูู** โ `Waiting for Engineers`
3. **ุงููููุฏุณ ููุฏู ุนุฑุถ** โ `pending`
4. **ุงูุฃุฏูู ููุจู ุงูุนุฑุถ** โ `accepted`:
   - ุงููุดุฑูุน โ `In Progress`
   - ุงููููุฏุณ โ `assignedEngineer`
   - ุงูุนุฑูุถ ุงูุฃุฎุฑู โ `rejected`
   - ุบุฑูุฉ ุงูุฏุฑุฏุดุฉ ุงูุฌูุงุนูุฉ โ ูุชู ุฅูุดุงุคูุง

---

## โ๏ธ ููุงุนุฏ ูููุฉ:

### ูููููุฏุณูู:
- โ ูููู ุชูุฏูู ุนุฑุถ ูุงุญุฏ ููุท ููู ูุดุฑูุน
- โ ูููู ุงูุชุนุฏูู ุฎูุงู ุณุงุนุฉ ููุท ูู ุงูุฅูุดุงุก
- โ ูููู ุงูุญุฐู ููุท ุฅุฐุง ูุงู ุงูุนุฑุถ `pending`
- โ ูุง ูููู ุชูุฏูู ุนุฑูุถ ุนูู ูุดุงุฑูุน ุบูุฑ ููุงูู ุนูููุง

### ููุฃุฏูู:
- โ ูููู ูุจูู/ุฑูุถ ุฃู ุนุฑุถ
- โ ุนูุฏ ูุจูู ุนุฑุถุ ูุชู ุฑูุถ ุงูุจุงูู ุชููุงุฆูุงู
- โ ูููู ุชุนุฏูู/ุญุฐู ุฃู ุนุฑุถ

### ููุนููุงุก:
- โ ูููู ุฑุคูุฉ ุฌููุน ุงูุนุฑูุถ ุนูู ูุดุงุฑูุนูู
- โ ูุง ูููู ูุจูู/ุฑูุถ ุงูุนุฑูุถ (ูุชู ูู ูุจู ุงูุฃุฏูู)

---

## ๐งช ุฃูุซูุฉ ููุงุฎุชุจุงุฑ:

### 1. ุงููููุฏุณ ููุฏู ุนุฑุถ
```http
POST /api/proposals/project/PROJECT_ID
Authorization: Bearer ENGINEER_TOKEN
Content-Type: application/json

{
  "description": "ุณุฃููู ุจุชูููุฐ ุงููุดุฑูุน ุจุฃุนูู ุงููุนุงููุฑ...",
  "estimatedTimeline": "3 ุฃุดูุฑ",
  "relevantExperience": "ูุฏู ุฎุจุฑุฉ 5 ุณููุงุช",
  "proposedBudget": {
    "amount": 50000,
    "currency": "SAR"
  }
}
```

### 2. ุงูุฃุฏูู ููุจู ุงูุนุฑุถ
```http
PUT /api/proposals/PROPOSAL_ID/status
Authorization: Bearer ADMIN_TOKEN
Content-Type: application/json

{
  "status": "accepted"
}
```

**ุงููุชูุฌุฉ:**
- ุงููุดุฑูุน: `assignedEngineer` = ุงููููุฏุณุ `status` = `In Progress`
- ุงูุนุฑูุถ ุงูุฃุฎุฑู: `status` = `rejected`
- ุบุฑูุฉ ุงูุฏุฑุฏุดุฉ: ูุชู ุฅูุดุงุคูุง ุชููุงุฆูุงู

### 3. ุงููููุฏุณ ูุนุฏู ุนุฑุถู (ุฎูุงู ุณุงุนุฉ)
```http
PUT /api/proposals/PROPOSAL_ID
Authorization: Bearer ENGINEER_TOKEN
Content-Type: application/json

{
  "description": "ูุตู ูุญุฏุซ",
  "proposedBudget": {
    "amount": 48000
  }
}
```

---

## โ Checklist ููุงุฎุชุจุงุฑ:

- [ ] ุงููููุฏุณ ููุฏู ุนุฑุถ ุนูู ูุดุฑูุน ููุงูู ุนููู
- [ ] ููุน ุชูุฏูู ุนุฑุถ ุนูู ูุดุฑูุน ุบูุฑ ููุงูู ุนููู
- [ ] ููุน ุชูุฏูู ุนุฑุถ ููุฑุฑ
- [ ] ุงูุฃุฏูู ููุจู ุนุฑุถ โ ุชุญุฏูุซ ุงููุดุฑูุน ูุงูุนุฑูุถ ุงูุฃุฎุฑู
- [ ] ุงููููุฏุณ ูุนุฏู ุนุฑุถู (ุฎูุงู ุณุงุนุฉ)
- [ ] ููุน ุชุนุฏูู ุงูุนุฑุถ ุจุนุฏ ุณุงุนุฉ
- [ ] ุงููููุฏุณ ูุญุฐู ุนุฑุถู (pending)
- [ ] ููุน ุญุฐู ุนุฑุถ ุบูุฑ pending
- [ ] ุงูุฃุฏูู ูุญุฐู ุฃู ุนุฑุถ
- [ ] ุงูุนููู ูุฑู ุฌููุน ุงูุนุฑูุถ ุนูู ูุดุงุฑูุนู

---

## ๐ ุญุงูุงุช ุงูุนุฑุถ (Status):

- `pending` - ูู ุงูุชุธุงุฑ ุงููุฑุงุฌุนุฉ (ุงูุชุฑุงุถู)
- `reviewed` - ุชูุช ุงููุฑุงุฌุนุฉ
- `accepted` - ููุจูู (ูุคุฏู ูุชุญุฏูุซ ุงููุดุฑูุน)
- `rejected` - ูุฑููุถ

---

**๐ ุงููุธุงู ุงูุขู ููุชูู ูุฌุงูุฒ ููุงุณุชุฎุฏุงู!**
